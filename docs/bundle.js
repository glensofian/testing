(()=>{"use strict";var e={56:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},72:e=>{var t=[];function n(e){for(var n=-1,r=0;r<t.length;r++)if(t[r].identifier===e){n=r;break}return n}function r(e,r){for(var o={},a=[],s=0;s<e.length;s++){var c=e[s],d=r.base?c[0]+r.base:c[0],l=o[d]||0,u="".concat(d," ").concat(l);o[d]=l+1;var p=n(u),h={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==p)t[p].references++,t[p].updater(h);else{var m=i(h,r);r.byIndex=s,t.splice(s,0,{identifier:u,updater:m,references:1})}a.push(u)}return a}function i(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,i){var o=r(e=e||[],i=i||{});return function(e){e=e||[];for(var a=0;a<o.length;a++){var s=n(o[a]);t[s].references--}for(var c=r(e,i),d=0;d<o.length;d++){var l=n(o[d]);0===t[l].references&&(t[l].updater(),t.splice(l,1))}o=c}}},113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},249:(e,t,n)=>{n.d(t,{A:()=>s});var r=n(601),i=n.n(r),o=n(314),a=n.n(o)()(i());a.push([e.id,"@import url(https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap);"]),a.push([e.id,"/* ========== FONT & RESET ========== */\n\n* {\n  margin: 0;\n  padding: 0;\n  box-sizing: border-box;\n  font-family: 'Inter', sans-serif;\n}\n\nbody {\n  background-color: #f7f9fc;\n  color: #333;\n  min-height: 100vh;\n  display: flex;\n  flex-direction: column;\n}\n\n/* ========== NAVBAR ========== */\nnav {\n  background: #4a6cf7;\n  color: white;\n  padding: 1rem 2rem;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  box-shadow: 0 2px 5px rgba(0,0,0,0.1);\n}\n\nnav a {\n  color: white;\n  text-decoration: none;\n  margin: 0 0.8rem;\n  font-weight: 500;\n  transition: opacity 0.2s;\n}\n\nnav a:hover {\n  opacity: 0.8;\n}\n\n#btn-install {\n  background: white;\n  color: #4a6cf7;\n  border: none;\n  border-radius: 6px;\n  padding: 6px 14px;\n  cursor: pointer;\n  font-weight: 600;\n}\n\n#btn-install:hover {\n  background: #f0f0f0;\n}\n\n/* ========== SKIP LINK ========== */\n.skip-link {\n  position: absolute;\n  left: -9999px;\n  top: 0;\n  background: #fff;\n  color: #000;\n  padding: 8px 12px;\n  border-radius: 6px;\n  z-index: 1000;\n}\n.skip-link:focus {\n  left: 8px;\n  top: 8px;\n  outline: 2px solid #4a6cf7;\n}\n\n/* ========== Push Notification ========== */\n#btn-subscribe, #btn-unsubscribe {\n  background: white;\n  color: #4a6cf7;\n  border: none;\n  border-radius: 6px;\n  padding: 6px 14px;\n  cursor: pointer;\n  font-weight: 600;\n  margin-left: 1rem;\n}\n\n#btn-subscribe:hover, #btn-unsubscribe:hover {\n  background: #f0f0f0;\n}\n\n/* ========== MAIN CONTAINER ========== */\nmain {\n  flex: 1;\n  padding: 2rem;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n}\n\n/* ========== FORM STYLING (Login, Register, Add Story) ========== */\nform {\n  background: #fff;\n  padding: 2rem;\n  width: 100%;\n  max-width: 400px;\n  border-radius: 12px;\n  box-shadow: 0 4px 10px rgba(0,0,0,0.08);\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n}\n\nform h2 {\n  text-align: center;\n  color: #4a6cf7;\n  margin-bottom: 0.5rem;\n}\n\nform label {\n  font-size: 0.9rem;\n  font-weight: 600;\n  color: #444;\n}\n\nform input,\nform textarea {\n  padding: 10px;\n  border: 1px solid #ddd;\n  border-radius: 8px;\n  font-size: 0.9rem;\n  outline: none;\n  transition: border-color 0.2s;\n}\n\nform input:focus,\nform textarea:focus {\n  border-color: #4a6cf7;\n}\n\nform button {\n  background: #4a6cf7;\n  color: white;\n  padding: 10px;\n  border: none;\n  border-radius: 8px;\n  cursor: pointer;\n  font-weight: 600;\n  transition: background 0.2s;\n}\n\nform button:hover {\n  background: #3d5be8;\n}\n\n/* ========== STORY LIST ========== */\n#story-list {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));\n  gap: 1.5rem;\n  margin-top: 2rem;\n  width: 100%;\n  max-width: 1200px;\n}\n\n.story-item {\n  background: #fff;\n  border-radius: 12px;\n  overflow: hidden;\n  box-shadow: 0 4px 12px rgba(0,0,0,0.08);\n  transition: transform 0.2s, box-shadow 0.2s;\n}\n\n.story-item:hover {\n  transform: translateY(-4px);\n  box-shadow: 0 8px 18px rgba(0,0,0,0.12);\n}\n\n.story-item img {\n  width: 100%;\n  height: 180px;\n  object-fit: cover;\n}\n\n.story-item h3 {\n  margin: 1rem;\n  font-size: 1.1rem;\n  color: #333;\n}\n\n.story-item p {\n  margin: 0 1rem 1rem;\n  color: #555;\n  font-size: 0.9rem;\n}\n\n.story-item small {\n  display: block;\n  margin: 0 1rem 1rem;\n  color: #888;\n  font-size: 0.8rem;\n}\n\n/* Buttons for Offline Save/Delete */\n.story-item button {\n  margin: 0 0.5rem 1rem;\n  padding: 8px 10px;\n  border: none;\n  border-radius: 6px;\n  cursor: pointer;\n  font-weight: 600;\n  font-size: 0.85rem;\n}\n\n.btn-save-offline {\n  background: #4a6cf7;\n  color: white;\n}\n\n.btn-save-offline:hover {\n  background: #3c5dd9;\n}\n\n.btn-delete-local {\n  background: #ff5252;\n  color: white;\n}\n\n.btn-delete-local:hover {\n  background: #e04141;\n}\n\n/* ========== MAP SECTION ========== */\n#map {\n  width: 100%;\n  max-width: 1000px;\n  height: 400px;\n  border-radius: 12px;\n  margin-top: 2rem;\n  box-shadow: 0 4px 12px rgba(0,0,0,0.08);\n}\n\n/* ========== RESPONSIVE ========== */\n@media (max-width: 600px) {\n  form {\n    padding: 1.5rem;\n  }\n\n  #story-list {\n    grid-template-columns: 1fr;\n  }\n}\n",""]);const s=a},314:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n="",r=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),r&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),r&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n}).join("")},t.i=function(e,n,r,i,o){"string"==typeof e&&(e=[[null,e,void 0]]);var a={};if(r)for(var s=0;s<this.length;s++){var c=this[s][0];null!=c&&(a[c]=!0)}for(var d=0;d<e.length;d++){var l=[].concat(e[d]);r&&a[l[0]]||(void 0!==o&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=o),n&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=n):l[2]=n),i&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=i):l[4]="".concat(i)),t.push(l))}},t}},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},601:e=>{e.exports=function(e){return e[1]}},659:e=>{var t={};e.exports=function(e,n){var r=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(n)}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var r="";n.supports&&(r+="@supports (".concat(n.supports,") {")),n.media&&(r+="@media ".concat(n.media," {"));var i=void 0!==n.layer;i&&(r+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),r+=n.css,i&&(r+="}"),n.media&&(r+="}"),n.supports&&(r+="}");var o=n.sourceMap;o&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleTagTransform(r,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={id:r,exports:{}};return e[r](o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.nc=void 0;var r=n(72),i=n.n(r),o=n(825),a=n.n(o),s=n(659),c=n.n(s),d=n(56),l=n.n(d),u=n(540),p=n.n(u),h=n(113),m=n.n(h),g=n(249),f={};f.styleTagTransform=m(),f.setAttributes=l(),f.insert=c().bind(null,"head"),f.domAPI=a(),f.insertStyleElement=p(),i()(g.A,f),g.A&&g.A.locals&&g.A.locals;const y="https://story-api.dicoding.dev/v1",b=class{static async getAllStories(e){const t=await fetch(`${y}/stories`,{headers:{Authorization:`Bearer ${e}`}}),n=await t.json();if(n.error)throw new Error(n.message);return n.listStory}static async register(e){const t=await fetch(`${y}/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),n=await t.json();if(n.error)throw new Error(n.message);return n}static async login(e){const t=await fetch(`${y}/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),n=await t.json();if(n.error)throw new Error(n.message);return n.loginResult}static async addNewStory(e){const t=localStorage.getItem("authToken");if(!t)throw new Error("User not authenticated");const n=await fetch(`${y}/stories`,{method:"POST",headers:{Authorization:`Bearer ${t}`},body:e}),r=await n.json();if(r.error)throw new Error(r.message);return r}static async subscribePush({endpoint:e,keys:t,p256dh:n,auth:r,token:i}){const o=await fetch(`${y}/notifications/subscribe`,{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify({endpoint:e,keys:t,p256dh:n,auth:r})}),a=await o.json();if(a.error)throw new Error(a.message);return a}static async unsubscribePush({endpoint:e,token:t}){const n=await fetch(`${y}/notifications/subscribe`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({endpoint:e})}),r=await n.json();if(r.error)throw new Error(r.message);return r}static setAuthToken(e){localStorage.setItem("authToken",e)}static getAuthToken(){return localStorage.getItem("authToken")}static removeAuthToken(){localStorage.removeItem("authToken")}},v={register:async e=>b.register(e),async login(e){const t=await b.login(e);return b.setAuthToken(t.token),t},addNewStory:async e=>b.addNewStory(e),async getAllStories(){const e=b.getAuthToken();if(!e)throw new Error("User not authenticated");return b.getAllStories(e)},getAuthToken:()=>b.getAuthToken(),removeAuthToken(){b.removeAuthToken()}},w=()=>new Promise((e,t)=>{const n=indexedDB.open("story-db",1);n.onupgradeneeded=()=>{const e=n.result;e.objectStoreNames.contains("stories")||e.createObjectStore("stories",{keyPath:"id"}).createIndex("createdAt","createdAt",{unique:!1})},n.onsuccess=()=>e(n.result),n.onerror=()=>t(n.error)});async function k(){const e=await w(),t=e.transaction("stories","readonly").objectStore("stories").getAll(),n=await new Promise(e=>{t.onsuccess=()=>e(t.result||[])});return e.close(),n}async function S(e){const t=await w(),n=t.transaction("stories","readwrite");n.objectStore("stories").delete(e),await(n.complete?.())||n.done?.(),t.close()}const x=class{constructor(e){this._container=e,this._map=null,this._markers={}}render(){this._container.innerHTML='<div class="content"> <h2>Peta Lokasi Cerita</h2> <div id="stories-map" style="height:400px;width:100%;margin-bottom:1rem"></div> <h2>Daftar Cerita</h2> <div id="story-list" class="story-list"> </div> </div>'}renderStoryList(e){const t=document.querySelector("#story-list");t.innerHTML="",e.forEach(e=>{const n=document.createElement("div");n.classList.add("story-item"),e.lat&&e.lon&&(n.dataset.id=e.id,n.dataset.lat=e.lat,n.dataset.lon=e.lon,n.classList.add("story-item--clickable")),n.innerHTML=`\n        <img src="${e.photoUrl}" alt="Foto cerita dari ${e.name}">\n        <h3>${e.name}</h3>\n        <p>${e.description}</p>\n        <small>Dibuat pada: ${new Date(e.createdAt).toLocaleDateString()}</small>\n        <div style="margin-top:.5rem; display:flex; gap:.5rem;">\n          <button class="btn-save-offline" data-id="${e.id}">Simpan Offline</button>\n          <button class="btn-delete-local" data-id="${e.id}">Hapus Lokal</button>\n        </div>\n      `,t.appendChild(n)})}renderMap(e){const t=e.filter(e=>e.lat&&e.lon),n=document.querySelector("#stories-map");0!==t.length?(this._map=L.map("stories-map").setView([t[0].lat,t[0].lon],10),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(this._map),t.forEach(e=>{const t=L.marker([e.lat,e.lon]).addTo(this._map);t.bindPopup(`\n        <div class="popup-content">\n          <img src="${e.photoUrl}" alt="${e.name}" style="width:100%; border-radius:4px;">\n          <b>${e.name}</b>\n          <p>${e.description.substring(0,50)}...</p>\n        </div>\n      `),this._markers[e.id]=t})):n.innerHTML="<p>Tidak ada cerita dengan data lokasi untuk ditampilkan di peta.</p>"}setOnStoryItemClick(e){document.querySelector("#story-list").addEventListener("click",t=>{const n=t.target.closest(".story-item--clickable");if(n){const{lat:t,lon:r,id:i}=n.dataset;e({lat:t,lon:r,id:i})}})}async bindOfflineButtons(){document.querySelector("#story-list").addEventListener("click",async e=>{const t=e.target.closest(".btn-save-offline"),n=e.target.closest(".btn-delete-local");if(t){const e=t.closest(".story-item"),n={id:e.dataset.id||crypto.randomUUID(),name:e.querySelector("h3").textContent,description:e.querySelector("p").textContent,photoUrl:e.querySelector("img").src,createdAt:(new Date).toISOString(),lat:Number(e.dataset.lat)||null,lon:Number(e.dataset.lon)||null};await async function(e){const t=await w(),n=t.transaction("stories","readwrite"),r=n.objectStore("stories");for(const t of e)r.put(t);await(n.complete?.())||n.done?.(),t.close()}([n]),alert("Disimpan ke Offline")}if(n){const e=n.dataset.id;await S(e),alert("Dihapus dari penyimpanan lokal")}})}focusMapOnStory({lat:e,lon:t,id:n}){this._map&&this._markers[n]&&(this._map.flyTo([e,t],15),this._markers[n].openPopup())}showError(e){document.querySelector("#story-list").innerHTML=`<p>${e}</p>`}redirectToLogin(){window.location.hash="#/login"}},_=class{constructor(e){this._view=new x(e)}async render(){if(v.getAuthToken()){this._view.render(),this._view.setOnStoryItemClick(e=>{this._view.focusMapOnStory(e)});try{const e=await v.getAllStories();this._view.renderStoryList(e),this._view.renderMap(e),await this._view.bindOfflineButtons()}catch(e){const t=await k();t.length?(this._view.renderStoryList(t),this._view.renderMap(t),await this._view.bindOfflineButtons()):this._view.showError(`Gagal memuat cerita: ${e.message}. Mungkin sesi Anda telah berakhir, silakan <a href="#/login">login kembali</a>.`),v.removeAuthToken()}}else this._view.redirectToLogin()}},T=class{constructor(e){this._container=e}render(){this._container.innerHTML='<div class="form-container"> <h2>Login</h2> <form id="login-form"> <div class="form-group"> <label for="login-email">Email</label> <input type="email" id="login-email" required> </div> <div class="form-group"> <label for="login-password">Password</label> <input type="password" id="login-password" minlength="8" required> </div> <button type="submit">Login</button> </form> <p>Belum punya akun? <a href="#/register">Daftar di sini</a></p> </div>'}getLoginInput(){return{email:document.querySelector("#login-email").value,password:document.querySelector("#login-password").value}}setOnLoginSubmit(e){document.querySelector("#login-form").addEventListener("submit",t=>{t.preventDefault(),e()})}showSuccess(e){alert(e),window.location.hash="#/home"}showError(e){alert(e)}},E=class{constructor(e){this._container=e}render(){this._container.innerHTML='<div class="form-container"> <h2>Register</h2> <form id="register-form"> <div class="form-group"> <label for="register-name">Nama</label> <input type="text" id="register-name" required/> </div> <div class="form-group"> <label for="register-email">Email</label> <input type="email" id="register-email" required/> </div> <div class="form-group"> <label for="register-password">Password</label> <input type="password" id="register-password" minlength="8" required/> </div> <button type="submit">Register</button> </form> <p>Sudah punya akun? <a href="#/login">Login di sini</a></p> </div> '}getRegisterInput(){return{name:document.querySelector("#register-name").value,email:document.querySelector("#register-email").value,password:document.querySelector("#register-password").value}}setOnRegisterSubmit(e){document.querySelector("#register-form").addEventListener("submit",t=>{t.preventDefault(),e()})}showSuccess(e){alert(e),window.location.hash="#/login"}showError(e){alert(e)}},A=class{constructor(e){this._container=e,this._stream=null,this._photo=null,this._latitude=null,this._longitude=null}render(){this._container.innerHTML='<div class="add-story-container"> <h2>Tambah Cerita Baru</h2> <form id="add-story-form"> <div class="camera-container"> <video id="camera-feed" autoplay playsinline></video> <canvas id="photo-canvas" class="hidden"></canvas> <img id="photo-preview" class="hidden" alt="Pratinjau gambar yang diambil"> </div> <button type="button" id="capture-button">Ambil Gambar</button> <div class="form-group"> <label for="story-description">Deskripsi</label> <textarea id="story-description" rows="4" required></textarea> </div> <div class="form-group"> <label for="story-photo">Upload Foto (opsional jika tidak ambil kamera)</label> <input type="file" id="story-photo" name="photo" accept="image/*"> </div> <div class="form-group"> <label for="story-location">Pilih Lokasi (Klik pada Peta)</label> <div id="map" style="height:300px;width:100%"></div> <input type="text" id="story-location" readonly="readonly" placeholder="Koordinat akan muncul di sini"> </div> <button type="submit">Unggah Cerita</button> </form> </div> ',this._initCamera(),this._initMap()}async _initCamera(){const e=document.querySelector("#camera-feed");try{this._stream=await navigator.mediaDevices.getUserMedia({video:!0}),e.srcObject=this._stream}catch(e){this.showError("Tidak bisa mengakses kamera. Pastikan Anda memberikan izin.")}}_initMap(){const e=L.map("map").setView([-6.2,106.816666],13);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(e);const t=L.marker([-6.2,106.816666]).addTo(e);e.on("click",e=>{const{lat:n,lng:r}=e.latlng;this._latitude=n,this._longitude=r,t.setLatLng(e.latlng),document.querySelector("#story-location").value=`Lat: ${n.toFixed(6)}, Lon: ${r.toFixed(6)}`})}_capturePhoto(){const e=document.querySelector("#camera-feed"),t=document.querySelector("#photo-canvas"),n=document.querySelector("#photo-preview"),r=t.getContext("2d");t.width=e.videoWidth,t.height=e.videoHeight,r.drawImage(e,0,0,t.width,t.height),t.toBlob(e=>{this._photo=e},"image/jpeg"),n.src=t.toDataURL("image/jpeg"),n.classList.remove("hidden"),e.classList.add("hidden"),this._stream&&this._stream.getTracks().forEach(e=>e.stop())}getStoryInput(){const e=document.querySelector("#story-description").value,t=document.querySelector("#story-photo"),n=t?.files?.[0],r=this._photo||n;if(!r||!e)return this.showError("Deskripsi dan foto tidak boleh kosong!"),null;const i=new FormData;return i.append("photo",r),i.append("description",e),this._latitude&&this._longitude&&(i.append("lat",this._latitude),i.append("lon",this._longitude)),i}setOnSubmit(e){document.querySelector("#capture-button").addEventListener("click",()=>this._capturePhoto()),document.querySelector("#add-story-form").addEventListener("submit",t=>{t.preventDefault(),e()})}showSuccess(e){alert(e),window.location.hash="#/home"}showError(e){alert(e)}},O=class{constructor(e){this._container=e}render(){this._container.innerHTML='<div class="content"> <h2>Story Tersimpan (Offline)</h2> <div id="saved-list" class="story-list"></div> </div> ',this.renderSavedList()}async renderSavedList(){const e=document.querySelector("#saved-list");e.innerHTML="<p>Memuatâ€¦</p>";const t=await k();t.length?(e.innerHTML="",t.forEach(t=>{const n=document.createElement("div");n.className="story-item",n.innerHTML=`\n        <img src="${t.photoUrl}" alt="Foto cerita dari ${t.name}">\n        <h3>${t.name}</h3>\n        <p>${t.description}</p>\n        <small>Disimpan: ${new Date(t.createdAt).toLocaleString()}</small>\n        <div style="margin:.5rem; display:flex; gap:.5rem;">\n          <button class="btn-delete-local" data-id="${t.id}">Unsave</button>\n        </div>\n      `,e.appendChild(n)}),e.addEventListener("click",async e=>{const t=e.target.closest(".btn-delete-local");t&&(await S(t.dataset.id),this.renderSavedList(),alert("Story dihapus dari penyimpanan lokal."))})):e.innerHTML="<p>Tidak ada story tersimpan.</p>"}},I={"/":_,"/home":_,"/login":class{constructor(e){this._view=new T(e)}async render(){this._view.render(),this._view.setOnLoginSubmit(async()=>{try{const{email:e,password:t}=this._view.getLoginInput();await v.login({email:e,password:t}),this._view.showSuccess("Login berhasil!")}catch(e){this._view.showError(`Login gagal: ${e.message}`)}})}},"/register":class{constructor(e){this._view=new E(e)}async render(){this._view.render(),this._view.setOnRegisterSubmit(async()=>{try{const e=this._view.getRegisterInput();await v.register(e),this._view.showSuccess("Registrasi berhasil! Silakan login.")}catch(e){this._view.showError(`Registrasi gagal: ${e.message}`)}})}},"/add-story":class{constructor(e){this._view=new A(e)}async render(){this._view.render(),this._view.setOnSubmit(async()=>{const e=this._view.getStoryInput();if(e)try{await v.addNewStory(e),this._view.showSuccess("Cerita berhasil diunggah!"),"granted"===Notification.permission&&navigator.serviceWorker?.ready&&(await navigator.serviceWorker.ready).showNotification("Story berhasil dibuat",{body:"Anda telah membuat story baru!",icon:"/icons/icon-192.png"})}catch(e){this._view.showError(`Gagal mengunggah cerita: ${e.message}`)}})}},"/saved":class{constructor(e){this._view=new O(e)}async render(){this._view.render()}}},M=new class{constructor(e,t){this._mainContent=e,this._routes=t}async renderPage(){const e=location.hash.slice(1).toLowerCase()||"/",t=this._routes[e]||this._routes["/"],n=async()=>{if(t){const e=new t(this._mainContent);await e.render()}else this._mainContent.innerHTML="<p>Halaman tidak ditemukan.</p>"};document.startViewTransition?document.startViewTransition(()=>{n()}):await n()}}(document.querySelector("#main-content"),I);function C(){const e=document.querySelector("nav");e&&(["#/login","#/register"].includes(window.location.hash)?e.style.display="none":e.style.display="flex")}let q;function $(){const e=!!localStorage.getItem("authToken"),t=document.getElementById("link-logout"),n=document.getElementById("link-saved");t&&(t.style.display=e?"inline":"none"),n&&(n.style.display=e?"inline":"none")}window.addEventListener("hashchange",()=>{M.renderPage(),C()}),window.addEventListener("load",()=>{M.renderPage(),C()}),window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),q=e;const t=document.getElementById("btn-install");t&&(t.style.display="inline-block")}),document.addEventListener("click",async e=>{"btn-install"===e.target.id&&q&&(q.prompt(),await q.userChoice,q=null,e.target.style.display="none")}),window.addEventListener("load",()=>{(async function(){if(!("serviceWorker"in navigator))return;const e=await navigator.serviceWorker.register("./sw.js",{scope:"./"});if("granted"!==await Notification.requestPermission())return void alert("Izin notifikasi ditolak. Aktifkan notifikasi agar update story bisa diterima.");const t=function(){const e=("BCCs2eonMI-6H2ctvFaWg-UYdDv387Vno_bzUzALpB442r2lCnsHmtrx8biyPi_E-1fSGABK_Qs_GlvPoJJqxbk"+"=".repeat(1)).replace(/-/g,"+").replace(/_/g,"/"),t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;++e)n[e]=t.charCodeAt(e);return n}(),n=localStorage.getItem("authToken"),r=document.getElementById("btn-subscribe"),i=document.getElementById("btn-unsubscribe");await e.pushManager.getSubscription()?(r.style.display="none",i.style.display="inline-block"):(r.style.display="inline-block",i.style.display="none"),r.addEventListener("click",async()=>{try{const o=await e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:t}),a=o.toJSON(),s={endpoint:o.endpoint,keys:{p256dh:a.keys.p256dh,auth:a.keys.auth}};if(!n)return void alert("Silakan login terlebih dahulu sebelum berlangganan notifikasi.");(await fetch("https://story-api.dicoding.dev/v1/notifications/subscribe",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(s)})).ok?(alert("Berhasil berlangganan notifikasi!"),r.style.display="none",i.style.display="inline-block"):alert("Gagal berlangganan notifikasi!")}catch(e){console.error("Subscribe error:",e)}}),i.addEventListener("click",async()=>{const t=await e.pushManager.getSubscription();t&&(await t.unsubscribe(),n&&(await fetch("https://story-api.dicoding.dev/v1/notifications/subscribe",{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({endpoint:t.endpoint})}),alert("Notifikasi berhasil dihentikan."),r.style.display="inline-block",i.style.display="none"))})})().catch(console.error)}),window.addEventListener("hashchange",$),window.addEventListener("load",$),document.addEventListener("click",e=>{"link-logout"===e.target.id&&(e.preventDefault(),v.removeAuthToken(),location.hash="#/login",$())})})();