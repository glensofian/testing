const APP_CACHE="app-shell-v1",RUNTIME_CACHE="runtime-v1",APP_SHELL=["/","/index.html","/bundle.js","https://unpkg.com/leaflet@1.9.4/dist/leaflet.css","https://unpkg.com/leaflet@1.9.4/dist/leaflet.js","/manifest.webmanifest","/icons/icon-192.png","/icons/icon-512.png"];self.addEventListener("install",t=>{t.waitUntil((async()=>{const t=await caches.open(APP_CACHE);await t.addAll(APP_SHELL),self.skipWaiting()})())}),self.addEventListener("activate",t=>{t.waitUntil((async()=>{const t=await caches.keys();await Promise.all(t.map(t=>t!==APP_CACHE&&"runtime-v1"!==t?caches.delete(t):null)),self.clients.claim()})())}),self.addEventListener("fetch",t=>{const{request:e}=t;"GET"===e.method&&(e.url.includes("/v1/stories")?t.respondWith((async()=>{try{const t=await fetch(e);return(await caches.open("runtime-v1")).put(e,t.clone()),t}catch{const t=await caches.open("runtime-v1");return await t.match(e)||new Response(JSON.stringify({error:!0,message:"offline"}),{headers:{"Content-Type":"application/json"}})}})()):"navigate"!==e.mode?t.respondWith((async()=>{const t=await caches.open("runtime-v1"),n=await t.match(e),a=fetch(e).then(n=>(t.put(e,n.clone()),n)).catch(()=>n);return n||a})()):t.respondWith((async()=>{try{const t=await fetch(e);return(await caches.open(APP_CACHE)).put("/",t.clone()),t}catch{return(await caches.open(APP_CACHE)).match("/index.html")}})()))}),self.addEventListener("push",t=>{let e={};try{e=t.data?t.data.json():{}}catch{e={}}const n=e.title||"Story berhasil dibuat",a=e.options||{body:"Story baru berhasil dibuat."};t.waitUntil(self.registration.showNotification(n,{...a,icon:"/icons/icon-192.png",badge:"/icons/icon-192.png"}))}),self.addEventListener("notificationclick",t=>{t.notification.close(),t.waitUntil((async()=>{const t=await clients.matchAll({type:"window"});for(const e of t)if("focus"in e)return void e.focus();clients.openWindow&&clients.openWindow("/#/home")})())});